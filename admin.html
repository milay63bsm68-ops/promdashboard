<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background:#020617;
  color:white;
  padding:30px;
}
.card {
  background:#0f172a;
  padding:20px;
  border-radius:14px;
  max-width:420px;
  margin:auto;
  position: relative;
}
input {
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:10px;
  border:none;
}
.password-container {
  position: relative;
}
.eye-icon {
  position: absolute;
  right: 12px;
  top: 14px;
  cursor: pointer;
  color: #aaa;
  font-size: 18px;
}
button {
  width:100%;
  padding:14px;
  margin-top:10px;
  border:none;
  border-radius:12px;
  font-weight:bold;
  cursor:pointer;
  opacity:0.5;
  transition: 0.2s;
}
button.enabled {
  opacity:1;
}
.load { background:#3b82f6; opacity:1 }
.deposit { background:#22c55e }
.withdraw { background:#ef4444 }
.balance {
  margin-top:15px;
  font-size:18px;
}
.message {
  margin-top:10px;
  font-size:16px;
  padding:8px;
  border-radius:8px;
}
.success { background: #22c55e; color: #fff; }
.error { background: #ef4444; color: #fff; }
.loading { background: #facc15; color: #000; font-weight:bold; }
</style>
</head>

<body>

<div class="card">
  <h2>Admin Balance Control</h2>

  <input id="telegramId" placeholder="Telegram User ID">

  <!-- Password with Eye Icon -->
  <div class="password-container">
    <input id="password" placeholder="Admin Password" type="password">
    <span id="togglePassword" class="eye-icon">üëÅÔ∏è</span>
  </div>

  <button class="load" onclick="loadBalance()">Load Balance</button>

  <div class="balance" id="balanceText"></div>
  <div id="messageBox"></div>

  <button id="depositBtn" class="deposit" onclick="handleAction('deposit')">
    ‚ûï Deposit
  </button>

  <button id="withdrawBtn" class="withdraw" onclick="handleAction('withdraw')">
    ‚ûñ Withdraw
  </button>
</div>

<script>
const API = "https://promdashboard-1.onrender.com";

const depositBtn = document.getElementById("depositBtn");
const withdrawBtn = document.getElementById("withdrawBtn");
const messageBox = document.getElementById("messageBox");
const balanceText = document.getElementById("balanceText");
const passwordInput = document.getElementById("password");
const togglePassword = document.getElementById("togglePassword");
const telegramId = document.getElementById("telegramId");

depositBtn.disabled = true;
withdrawBtn.disabled = true;

// Toggle password visibility
togglePassword.addEventListener("click", () => {
  if (passwordInput.type === "password") {
    passwordInput.type = "text";
    togglePassword.textContent = "üôà"; // closed eye
  } else {
    passwordInput.type = "password";
    togglePassword.textContent = "üëÅÔ∏è"; // open eye
  }
});

function enableButtons() {
  depositBtn.disabled = false;
  withdrawBtn.disabled = false;
  depositBtn.classList.add("enabled");
  withdrawBtn.classList.add("enabled");
}

function disableButtons() {
  depositBtn.disabled = true;
  withdrawBtn.disabled = true;
  depositBtn.classList.remove("enabled");
  withdrawBtn.classList.remove("enabled");
}

function showMessage(msg, type="success") {
  messageBox.innerHTML = `<div class="message ${type}">${msg}</div>`;
}

function showLoading(msg="Loading...") {
  messageBox.innerHTML = `<div class="message loading">${msg}</div>`;
}

async function loadBalance() {
  if (!telegramId.value) {
    showMessage("‚ùå Please enter a Telegram ID", "error");
    return;
  }

  showLoading("Fetching balance...");
  disableButtons();

  try {
    const res = await fetch(API + "/admin/get-balance", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-admin-password": passwordInput.value
      },
      body: JSON.stringify({ telegramId: telegramId.value })
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.error || `Server error: ${res.status}`);
    if (data.error) throw new Error(data.error);

    balanceText.innerText = `Current Balance: ‚Ç¶${data.ngn.toLocaleString()}`;
    showMessage("‚úÖ Balance loaded successfully", "success");
    enableButtons();

  } catch (err) {
    balanceText.innerText = "";
    disableButtons();
    showMessage(`‚ùå Failed to load balance: ${err.message}`, "error");
  }
}

async function handleAction(type) {
  const amount = prompt(
    type === "deposit" 
      ? "Enter deposit amount (NGN)" 
      : "Enter withdrawal amount (NGN)"
  );

  if (!amount || isNaN(amount) || Number(amount) <= 0) {
    showMessage("‚ùå Invalid amount entered", "error");
    return;
  }

  showLoading(`${type === "deposit" ? "Depositing" : "Withdrawing"} ‚Ç¶${Number(amount).toLocaleString()}...`);
  disableButtons();

  try {
    const res = await fetch(API + "/admin/update-balance", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-admin-password": passwordInput.value
      },
      body: JSON.stringify({
        telegramId: telegramId.value,
        amount: Number(amount),
        type
      })
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.error || `Server error: ${res.status}`);
    if (data.error) throw new Error(data.error);

    balanceText.innerText = `Current Balance: ‚Ç¶${data.newBalance.toLocaleString()}`;
    showMessage(`‚úÖ ${type === "deposit" ? "Deposit" : "Withdrawal"} successful!`, "success");
    enableButtons();

  } catch (err) {
    showMessage(`‚ùå Failed to ${type}: ${err.message}`, "error");
  }
}
</script>

</body>
</html>