<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Unlock Promo Earnings</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  background:#020617;
  color:white;
  font-family:Arial, sans-serif;
  padding:20px;
}
.container {
  max-width:480px;
  margin:auto;
}
.card {
  background:#0f172a;
  padding:16px;
  border-radius:14px;
  margin-bottom:15px;
}
button {
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  font-weight:bold;
  margin-top:10px;
  cursor:pointer;
}
.primary { background:#22c55e; color:white; }
.secondary { background:#3b82f6; color:white; }
input, select {
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  margin-top:10px;
  background:#020617;
  color:white;
}
.hidden { display:none; }
.status {
  margin-top:10px;
  font-size:14px;
  text-align:center;
}
</style>
</head>

<body>
<div class="container">

  <div class="card" id="userInfo"></div>

  <div class="card">
    <b>ğŸ”“ Unlock Promo Earnings</b><br><br>
    Choose how you want to unlock ğŸ‘‡
  </div>

  <div class="card">
    <button class="primary" onclick="showTask()">âœ… Complete Simple Task</button>
    <button class="secondary" onclick="showPurchase()">ğŸ’³ Purchase Access</button>
  </div>

  <!-- TASK -->
  <div class="card hidden" id="taskBox">
    <b>ğŸ“Œ Task</b><br><br>
    Join WhatsApp group & invite <b>10 people</b>

    <input id="taskWhatsapp" placeholder="WhatsApp number">
    <input id="taskCall" placeholder="Calling number">
    <input type="file" accept="image/*" id="taskShot">

    <button class="primary" onclick="submitTask()">Submit Task</button>
    <div class="status" id="taskStatus"></div>
  </div>

  <!-- PURCHASE -->
  <div class="card hidden" id="purchaseBox">
    <b>ğŸ¦ Bank:</b> 9114301708 (Opay)<br>
    <b>ğŸ’° BNB (BEP20):</b><br>
    <small>0xbBcc409872bC2441400735624638F3D67DAa7C4C</small>

    <input id="payWhatsapp" placeholder="WhatsApp number">
    <input id="payCall" placeholder="Calling number">

    <select id="payMethod">
      <option value="">Select method</option>
      <option>Bank Transfer</option>
      <option>BNB (BEP20)</option>
    </select>

    <input type="file" accept="image/*" id="payShot">

    <button class="secondary" onclick="submitPayment()">Submit Payment</button>
    <div class="status" id="payStatus"></div>
  </div>

</div>

<script>
const tg = Telegram.WebApp;
tg.ready();

const BACKEND = "https://promdashboard.onrender.com";
const user = tg.initDataUnsafe.user;

const telegramId = user.id;
const name = user.first_name;
const username = user.username ? "@"+user.username : "No username";

userInfo.innerHTML = `
<b>Name:</b> ${name}<br>
<b>Username:</b> ${username}<br>
<b>ID:</b> ${telegramId}
`;

function showTask(){
  taskBox.classList.remove("hidden");
  purchaseBox.classList.add("hidden");
  taskStatus.innerHTML = "";
}
function showPurchase(){
  purchaseBox.classList.remove("hidden");
  taskBox.classList.add("hidden");
  payStatus.innerHTML = "";
}

function toBase64(file){
  return new Promise(r=>{
    const fr = new FileReader();
    fr.onload = ()=>r(fr.result);
    fr.readAsDataURL(file);
  });
}

async function submitTask(){
  const img = taskShot.files[0];
  if(!img) return alert("Upload screenshot");
  taskStatus.innerHTML = "â³ Sending task to admin...";
  
  const image = await toBase64(img);
  const message =
`ğŸŸ¢ PROMO TASK SUBMISSION
Name: ${name}
Username: ${username}
ID: ${telegramId}
WhatsApp: ${taskWhatsapp.value}
Call: ${taskCall.value}`;

  try {
    const res = await fetch(BACKEND+"/notify-admin-image",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ message, image, telegramId })
    });
    const data = await res.json();
    if(data.success){
      taskStatus.innerHTML = "âœ… Task sent for review";
      tg.close();
    } else {
      taskStatus.innerHTML = "âŒ Failed to send task. Try again.";
    }
  } catch(err){
    taskStatus.innerHTML = "âŒ Error sending task.";
    console.error(err);
  }
}

async function submitPayment(){
  const img = payShot.files[0];
  if(!img) return alert("Upload payment proof");
  payStatus.innerHTML = "â³ Sending payment proof...";

  const image = await toBase64(img);
  const message =
`ğŸŸ¡ PROMO PAYMENT
Name: ${name}
Username: ${username}
ID: ${telegramId}
Method: ${payMethod.value}
WhatsApp: ${payWhatsapp.value}
Call: ${payCall.value}`;

  try {
    const res = await fetch(BACKEND+"/notify-admin-image",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ message, image, telegramId })
    });
    const data = await res.json();
    if(data.success){
      payStatus.innerHTML = "âœ… Payment sent for confirmation";
      tg.close();
    } else {
      payStatus.innerHTML = "âŒ Failed to send payment. Try again.";
    }
  } catch(err){
    payStatus.innerHTML = "âŒ Error sending payment.";
    console.error(err);
  }
}
</script>
</body>
</html>