<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Unlock Promo Earnings</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  background:#020617;
  color:white;
  font-family:Arial, sans-serif;
  padding:20px;
}
.container {
  max-width:480px;
  margin:auto;
}
.card {
  background:#0f172a;
  padding:16px;
  border-radius:14px;
  margin-bottom:15px;
}
button {
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  font-weight:bold;
  margin-top:10px;
  cursor:pointer;
}
.primary { background:#22c55e; color:white; }
.secondary { background:#3b82f6; color:white; }
.whatsapp { background:#25D366; color:white; }
.copy { background:#334155; color:white; font-size:13px; }
input, select {
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  margin-top:10px;
  background:#020617;
  color:white;
  height:40px;
}
.status {
  margin-top:10px;
  font-size:14px;
  text-align:center;
}
.hidden { display:none; }
.addressBox {
  margin-top:12px;
  padding:14px;
  background:#020617;
  border-radius:10px;
  font-size:14px;
  line-height:1.6;
}
.small {
  font-size:12px;
  opacity:0.85;
}
</style>
</head>

<body>
<div class="container">

  <!-- USER INFO -->
  <div class="card" id="userInfo">Loading user info...</div>

  <!-- BOT LINK -->
  <div class="card">
    <b>ğŸ¤– Promo Bot</b><br><br>
    <a href="https://t.me/intelpremiumbot" target="_blank">
      <button class="secondary">ğŸ¤– Open Bot</button>
    </a>
  </div>

  <!-- UNLOCK OPTIONS -->
  <div class="card">
    <b>ğŸ”“ Unlock Promo Earnings</b><br><br>
    Choose how you want to unlock ğŸ‘‡
  </div>

  <div class="card">
    <button class="primary" onclick="showTask()">âœ… Complete Simple Task</button>
    <button class="secondary" onclick="showPurchase()">ğŸ’³ Purchase Access</button>
  </div>

  <!-- TASK -->
  <div class="card hidden" id="taskBox">
    <b>ğŸ“Œ Task</b><br><br>
    1ï¸âƒ£ Join WhatsApp group<br>
    2ï¸âƒ£ Invite <b>10 people</b><br><br>

    <a href="https://chat.whatsapp.com/FVt9vJB1sbJ9q5LTQ0nB3O?mode=gi_t" target="_blank">
      <button class="whatsapp">ğŸ“² Join WhatsApp Group</button>
    </a>
    <button class="copy" onclick="copyText('https://chat.whatsapp.com/FVt9vJB1sbJ9q5LTQ0nB3O?mode=gi_t')">
      ğŸ“‹ Copy WhatsApp Group Link
    </button>

    <input id="taskWhatsapp" placeholder="Your WhatsApp number">
    <input id="taskCall" placeholder="Calling number">
    <input type="file" accept="image/*" id="taskShot" multiple>

    <button class="primary" onclick="submitTask()">Submit Task</button>
    <div class="status" id="taskStatus"></div>
  </div>

  <!-- PURCHASE -->
  <div class="card hidden" id="purchaseBox">
    <b>ğŸ’³ Select Payment Method</b>

    <select id="payMethod" onchange="updatePaymentAddress()">
      <option value="">Select method</option>
      <option value="bank">Bank Transfer</option>
      <option value="bnb">BNB Smart Chain (BEP20)</option>
    </select>

    <div id="paymentAddress" class="addressBox hidden"></div>

    <input id="payWhatsapp" placeholder="Your WhatsApp number">
    <input id="payCall" placeholder="Calling number">
    <input type="file" accept="image/*" id="payShot">

    <button class="secondary" onclick="submitPayment()">Submit Payment</button>
    <div class="status" id="payStatus"></div>
  </div>

</div>

<script>
const tg = Telegram.WebApp;
tg.ready();

const BACKEND = "https://promdashboard.onrender.com";
const user = tg.initDataUnsafe?.user || {};

const telegramId = user.id;
const name = user.first_name || "Guest";
const username = user.username ? "@"+user.username : "No username";

document.getElementById("userInfo").innerHTML = `
<b>Name:</b> ${name}<br>
<b>Username:</b> ${username}<br>
<b>ID:</b> ${telegramId}
`;

function showTask(){
  taskBox.classList.remove("hidden");
  purchaseBox.classList.add("hidden");
  taskStatus.innerHTML = "";
}

function showPurchase(){
  purchaseBox.classList.remove("hidden");
  taskBox.classList.add("hidden");
  payStatus.innerHTML = "";
}

function updatePaymentAddress(){
  const method = payMethod.value;
  const box = document.getElementById("paymentAddress");

  if(method === "bank"){
    box.innerHTML = `
<b>ğŸ¦ Bank Transfer Details</b><br><br>
<b>Account Name:</b><br>Intel Premium<br><br>
<b>Account Number:</b><br><span id="bankAcc">9114301708</span><br><br>
<b>Bank Name:</b><br>Opay<br><br>
<button class="copy" onclick="copyText('9114301708')">ğŸ“‹ Copy Account Number</button>
    `;
    box.classList.remove("hidden");
  } 
  else if(method === "bnb"){
    box.innerHTML = `
<b>ğŸ’ Crypto Payment</b><br><br>
<b>Network:</b><br>BNB Smart Chain (BEP20)<br><br>
<b>Wallet Address:</b><br><span id="bnbAddr">0xbBcc409872bC2441400735624638F3D67DAa7C4C</span><br><br>
<button class="copy" onclick="copyText('0xbBcc409872bC2441400735624638F3D67DAa7C4C')">ğŸ“‹ Copy Wallet Address</button>
<p class="small">âš ï¸ Send ONLY <b>BNB (BEP20)</b> to this address. Sending other tokens will result in permanent loss.</p>
    `;
    box.classList.remove("hidden");
  } 
  else {
    box.classList.add("hidden");
  }
}

function copyText(text){
  navigator.clipboard.writeText(text).then(()=>{ alert("Copied successfully âœ…"); });
}

function toBase64(file){
  return new Promise(resolve=>{
    const fr = new FileReader();
    fr.onload = ()=>resolve(fr.result);
    fr.readAsDataURL(file);
  });
}

async function submitTask(){
  const files = taskShot.files;
  if(!files.length){
    taskStatus.innerHTML = "âŒ Upload at least one screenshot";
    return;
  }
  taskStatus.innerHTML = "â³ Sending task...";
  try{
    for(let f of files){
      const image = await toBase64(f);
      const payload = {
        telegramId,
        name,
        username,
        method: "",
        whatsapp: taskWhatsapp.value,
        call: taskCall.value,
        image,
        type: "task"
      };
      await fetch(BACKEND+"/unlock-promo", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify(payload)
      });
    }
    taskStatus.innerHTML = "âœ… Task sent for review";
    tg.close();
  }catch(err){
    console.error(err);
    taskStatus.innerHTML = "âŒ Error sending task";
  }
}

async function submitPayment(){
  const file = payShot.files[0];
  if(!file || !payMethod.value){
    payStatus.innerHTML = "âŒ Select method & upload proof";
    return;
  }
  payStatus.innerHTML = "â³ Sending payment...";
  try{
    const image = await toBase64(file);
    const payload = {
      telegramId,
      name,
      username,
      method: payMethod.value,
      whatsapp: payWhatsapp.value,
      call: payCall.value,
      image,
      type: "payment"
    };
    await fetch(BACKEND+"/unlock-promo", {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify(payload)
    });
    payStatus.innerHTML = "âœ… Payment sent for review";
    tg.close();
  }catch(err){
    console.error(err);
    payStatus.innerHTML = "âŒ Error sending payment";
  }
}
</script>
</body>
</html>