<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Unlock Promo Earnings</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  background:#020617;
  color:white;
  font-family:Arial, sans-serif;
  padding:20px;
}
.container { max-width:480px; margin:auto; }
.card { background:#0f172a; padding:16px; border-radius:14px; margin-bottom:15px; }
button { width:100%; padding:14px; border:none; border-radius:12px; font-weight:bold; margin-top:10px; cursor:pointer; }
.primary { background:#22c55e; color:white; }
.secondary { background:#3b82f6; color:white; }
.whatsapp { background:#25D366; color:white; }
.telegram { background:#0088cc; color:white; }
.copy { background:#334155; color:white; font-size:13px; }
input {
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  margin-top:10px;
  background:#020617;
  color:white;
  height:26px;
}
select {
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  margin-top:10px;
  background:#020617;
  color:white;
  height:50px;
}
.status { margin-top:10px; font-size:14px; text-align:center; }
.hidden { display:none; }
.addressBox {
  margin-top:12px;
  padding:14px;
  background:#020617;
  border-radius:10px;
  font-size:14px;
  line-height:1.6;
}
.small { font-size:12px; opacity:0.85; }
.amount { color:#22c55e; font-weight:bold; font-size:16px; }
</style>
</head>

<body>
<div class="container">

<div class="card" id="userInfo">Loading user info...</div>

<div class="card">
<b>ğŸ”“ Unlock Promo Earnings</b><br><br>
Choose how you want to unlock ğŸ‘‡
</div>

<div class="card">
<button class="primary" onclick="showTask()">âœ… Complete Simple Task</button>
<p style="text-align:center"><b>OR</b></p>
<button class="secondary" onclick="showPurchase()">ğŸ’³ Purchase Access</button>
<button onclick="location.href='dashboard.html'">ğŸ”™ Back to dashboard</button>
</div>

<!-- TASK -->
<div class="card hidden" id="taskBox">
<b>ğŸ“Œ Task</b><br><br>
1ï¸âƒ£ Join WhatsApp or Telegram group<br>
2ï¸âƒ£ Invite <b>10 people</b><br>
3ï¸âƒ£ Upload <b>screenshots or any proof</b><br><br>

<select id="taskType" onchange="selectTask()">
  <option value="">Select task type</option>
    <option value="telegram">Telegram Task</option>
  <option value="whatsapp">WhatsApp Task</option>
</select>

<!-- WhatsApp -->
<div id="whatsappBox" class="hidden">
<a href="https://chat.whatsapp.com/FVt9vJB1sbJ9q5LTQ0nB3O?mode=gi_t" target="_blank">
<button class="whatsapp">ğŸ“² Join WhatsApp Group</button>
</a>
<button class="copy" onclick="copyText('https://chat.whatsapp.com/FVt9vJB1sbJ9q5LTQ0nB3O?mode=gi_t')">
ğŸ“‹ Copy WhatsApp Group Link
</button>
<input id="taskWhatsapp" placeholder="Your WhatsApp number">
</div>

<!-- Telegram -->
<div id="telegramBox" class="hidden">
<a href="https://t.me/YourTelegramGroup" target="_blank">
<button class="telegram">ğŸ“² Join Telegram Group</button>
</a>
<button class="copy" onclick="copyText('https://t.me/YourTelegramGroup')">
ğŸ“‹ Copy Telegram Group Link
</button>
<input id="taskTelegram" placeholder="Your Telegram username or ID">
</div>

<input id="taskCall" placeholder="Calling number">
<input type="file" accept="image/*" id="taskShot" multiple>

<button class="primary" onclick="submitTask()">Submit Task</button>
<div class="status" id="taskStatus"></div>
</div>

<!-- PURCHASE -->
<div class="card hidden" id="purchaseBox">
<b>ğŸ’³ Select Payment Method</b>

<select id="payMethod" onchange="updatePaymentAddress()">
<option value="">Select method</option>
<option value="bank">Bank Transfer</option>
<option value="bnb">BNB Smart Chain (BEP20)</option>
</select>

<div id="paymentAddress" class="addressBox hidden"></div>

<input id="payWhatsapp" placeholder="Your WhatsApp number">
<input id="payCall" placeholder="Calling number">
<input type="file" accept="image/*" id="payShot">

<button class="secondary" onclick="submitPayment()">Submit Payment</button>
<div class="status" id="payStatus"></div>
</div>

</div>

<script>
const tg = Telegram.WebApp;
tg.ready();

const BACKEND = "https://promo-oz59.onrender.com";
const user = tg.initDataUnsafe?.user || {};
const telegramId = user.id;
const name = user.first_name || "Guest";
const username = user.username ? "@"+user.username : "No username";

userInfo.innerHTML = `
<b>Name:</b> ${name}<br>
<b>Username:</b> ${username}<br>
<b>ID:</b> ${telegramId || "Not available"}
`;

function showTask(){
  taskBox.classList.remove("hidden");
  purchaseBox.classList.add("hidden");
}

function showPurchase(){
  purchaseBox.classList.remove("hidden");
  taskBox.classList.add("hidden");
}

function selectTask(){
  const type = taskType.value;
  whatsappBox.classList.toggle("hidden", type !== "whatsapp");
  telegramBox.classList.toggle("hidden", type !== "telegram");
}

function updatePaymentAddress(){
  const box = paymentAddress;
  if(payMethod.value === "bank"){
    box.innerHTML = `
<b>ğŸ¦ Bank Transfer</b><br><br>
<b>ğŸ’° Amount to Pay:</b><br>
<span class="amount">â‚¦2,000 (exactly)</span><br><br>
Account Name: Olatunji Abdulmalik Ayomide<br>
Account Number: 9114301708<br>
Bank: Opay<br><br>
<span class="small">âš ï¸ Pay the exact amount.</span><br><br>
<button class="copy" onclick="copyText('9114301708')">ğŸ“‹ Copy Account Number</button>
`;
    box.classList.remove("hidden");
  } else if(payMethod.value === "bnb"){
    box.innerHTML = `
<b>ğŸ’ Crypto Payment (BNB Smart Chain â€“ BEP20)</b><br><br>
<b>ğŸ’° Amount to Pay:</b><br>
<span class="amount">$4.5 (USD)</span><br><br>
<b>Wallet Address:</b><br>
0xbBcc409872bC2441400735624638F3D67DAa7C4C<br><br>
<button class="copy" onclick="copyText('0xbBcc409872bC2441400735624638F3D67DAa7C4C')">ğŸ“‹ Copy BNB Address</button>
`;
    box.classList.remove("hidden");
  } else box.classList.add("hidden");
}

function copyText(text){
  navigator.clipboard.writeText(text);
  tg.showAlert("Copied âœ…");
}

async function submitTask(){
  const type = taskType.value;
  if(!type) return taskStatus.innerHTML="âŒ Select task type";
  if(!taskShot.files.length) return taskStatus.innerHTML="âŒ Upload screenshot";

  taskStatus.innerHTML="â³ Sending...";

  for(const f of taskShot.files){
    const image = await toBase64(f);
    await fetch(BACKEND+"/unlock-promo",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({
        telegramId,name,username,
        method:"Task",
        whatsapp: type==="whatsapp" ? taskWhatsapp.value : "N/A",
        telegramTask: type==="telegram" ? taskTelegram.value : "N/A",
        call:taskCall.value||"N/A",
        image,type:"task"
      })
    });
  }

  taskStatus.innerHTML="âœ… Task submitted";
  tg.showAlert("Task submitted âœ…");
}

function toBase64(file){
  return new Promise((resolve,reject)=>{
    const reader=new FileReader();
    reader.onload=e=>resolve(e.target.result);
    reader.onerror=reject;
    reader.readAsDataURL(file);
  });
}

async function submitPayment(){
  if(!payMethod.value || !payShot.files[0]) return payStatus.innerHTML="âŒ Missing data";

  payStatus.innerHTML="â³ Sending...";
  const image = await toBase64(payShot.files[0]);
  await fetch(BACKEND+"/unlock-promo",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      telegramId,name,username,
      method:payMethod.value,
      whatsapp:payWhatsapp.value||"N/A",
      call:payCall.value||"N/A",
      image,type:"payment"
    })
  });

  payStatus.innerHTML="âœ… Payment sent";
  tg.showAlert("Payment submitted âœ…");
}
</script>
</body>
</html>